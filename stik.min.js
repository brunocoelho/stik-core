// ==========================================================================
// Project:   Stik.js - JavaScript Separation Of Concerns
// Copyright: Copyright 2011-2013 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/lukelex/stik.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.7.0 | From: 19-01-2014

window.stik={},function(){function a(a,b,c,d){if(!a)throw"controller is missing";if(!b)throw"action is missing";if(!c)throw"template is missing";if(!d)throw"execution unit is missing";this.$$controller=a,this.$$action=b,this.$$template=c,this.$$executionUnit=d,this.$$viewBag=new window.stik.ViewBag(c)}a.prototype.$load=function(a,b){var c=this.$resolveDependencies(this.$mergeModules(a,b));this.$$executionUnit.apply({},c),this.$markAsBound()},a.prototype.$resolveDependencies=function(a){var b=new window.stik.Injector(this.$$executionUnit,a);return b.$resolveDependencies()},a.prototype.$mergeModules=function(a,b){return a.$context=this,a.$template=this.$wrapTemplate(this.$$template,b),a.$viewBag=this.$$viewBag,a},a.prototype.$wrapTemplate=function(a,b){return b?b(a):a},a.prototype.$markAsBound=function(){this.$$template.className=(this.$$template.className+" stik-bound").trim()},window.stik.Context=a}(),function(){function a(a,b){if(!a)throw"name is missing";if(-1!==a.indexOf(" "))throw"invalid name. Please use dash(-) instead of spaces";if(!b)throw"executionUnit is missing";this.$$className=a,this.$$name=c+"-"+a,this.$$executionUnit=b}var b="data-behaviors",c="bh";a.prototype.$load=function(a,b,c){b.$template=this.$wrapTemplate(a,c);var d=this.$resolveDependencies(b);this.$$executionUnit.apply({},d),this.$markAsApplyed(a)},a.prototype.$wrapTemplate=function(a,b){return b?b(a):a},a.prototype.$resolveDependencies=function(a){var b=new window.stik.Injector(this.$$executionUnit,a);return b.$resolveDependencies()},a.prototype.$markAsApplyed=function(a){var c;c=a.getAttribute(b),c=((c||"")+" "+this.$$name).trim(),a.setAttribute(b,c)},window.stik.Behavior=a}(),function(){function a(a,b){if(-1!==a.indexOf(" "))throw"Invalid 'as'. Can't have spaces";if(!b)throw"Invalid 'to'. Can't be null";this.$$as=a,this.$$to=b}window.stik.Boundary=a}(),function(){function a(){this.$$subscriptions={}}function b(a,b){this.$$id="#"+Math.floor(16777215*Math.random()).toString(16),this.$$box=a,this.$$opener=b}a.prototype.$receive=function(a,c){var d=new b(a,c);return this.$$subscriptions[a]=this.$$subscriptions[a]||[],this.$$subscriptions[a].push(d),this.$unsubscribe.bind(this,d)},a.prototype.$unsubscribe=function(a){this.$$subscriptions[a.$$box]=this.$$subscriptions[a.$$box].filter(function(b){return b.$$id!==a.$$id})},a.prototype.$send=function(a,b){var c,d;if(c=this.$$subscriptions[a],!c||0===c.length)throw"no one is waiting for this message";for(d=c.length;d--;)c[d].$$opener(b)},window.stik.Courier=a}(),function(){function a(a,b){this.$$executionUnit=a,this.$$modules=b}a.prototype.$resolveDependencies=function(){var a=this.$extractArguments();return this.$grabModules(a)},a.prototype.$extractArguments=function(){var a,b,c;return a=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,b=this.$$executionUnit.toString(),c=b.match(a)[1].split(","),this.$trimmedArgs(c)},a.prototype.$grabModules=function(a){var b,c=[];if(1===a.length&&""===a[0])return[];for(var d=0;d<a.length;d++){if(!(b=this.$$modules[a[d]]))throw"Â¿"+a[d]+"? These are not the droids you are looking for! (e.g. this module does not exists)";c.push(b)}return c},a.prototype.$trimmedArgs=function(a){var b=[];return a.forEach(function(a){b.push(a.trim())}),b},window.stik.Injector=a}(),function(){function a(){}a.prototype.$baseUrl=function(){return location.href},a.prototype.$pathName=function(){return location.pathname},a.prototype.$hash=function(a){return this.$locationHash(a).replace(/^#/,"")},a.prototype.$locationHash=function(a){return a&&(location.hash=a),location.hash},a.prototype.$mainPath=function(){return"/"+this.$pathName().split("/")[1]},a.prototype.$queries=function(){var a,b,c;if(b=this.$baseUrl().split("?")[1]){b=b.split("&"),a={};for(var d=0;d<b.length;d++)c=b[d].split("="),a[c[0]]=c[1];return a}return{}},window.stik.UrlState=a}(),function(){function a(a){this.$$template=a}var b="data-bind";a.prototype.$push=function(a){var c,d;c=this.$fieldsToBind();for(var e=0;e<c.length;e++)d=c[e].getAttribute(b),a[d]&&this.$updateElementValue(c[e],a[d])},a.prototype.$render=a.prototype.$push,a.prototype.$pull=function(){var a,c,d;c={},a=this.$fieldsToBind();for(var e=0;e<a.length;e++)d=a[e].getAttribute(b),c[d]=this.$extractValueOf(a[e]);return c},a.prototype.$extractValueOf=function(a){return"INPUT"===a.nodeName.toUpperCase()||"TEXTAREA"===a.nodeName.toUpperCase()?a.value:a.textContent},a.prototype.$updateElementValue=function(a,b){"INPUT"===a.nodeName.toUpperCase()||"TEXTAREA"===a.nodeName.toUpperCase()?a.value=b:a.textContent=b},a.prototype.$fieldsToBind=function(){return this.$$template.getAttribute(b)?[this.$$template]:this.$$template.querySelectorAll("["+b+"]")},window.stik.ViewBag=a}(),function(){function a(a,b){this.$$contexts=[],this.$$behaviors=[],this.$$executionUnits={},this.$$modules=a||{},this.$$selector=b,this.$$boundaries={controller:{},behavior:{}}}a.prototype.$addController=function(a,b,c){if(!a)throw"controller can't be empty";if(!b)throw"action can't be empty";if(!c)throw"execution unit is missing";this.$storeExecutionUnit(a,b,c),this.$bindExecutionUnit(a,b,c)},a.prototype.$addBehavior=function(a,b){var c;if(this.$isBehaviorRegistered(a))throw"behavior already exist with the specified name";return c=this.$createBehavior(a,b),this.$$behaviors.push(c),this.$applyBehavior(c),c},a.prototype.$addBoundary=function(a,b,c){var d;return this.$validateFrom(b),d=new window.stik.Boundary(a,c),this.$$boundaries[b.toLowerCase()][a]=d,d},a.prototype.$validateFrom=function(a){var b=a.toLowerCase();if("controller"!==b&&"behavior"!==b)throw"Invalid 'from'. Needs to be 'controller' or 'behavior'"},a.prototype.$isBehaviorRegistered=function(a){for(var b=this.$$behaviors.length;b--;)if(this.$$behaviors[b].$$name===a)return!0;return!1},a.prototype.$createBehavior=function(a,b){return new window.stik.Behavior(a,b)},a.prototype.$storeExecutionUnit=function(a,b,c){if(this.$$executionUnits[a]=this.$$executionUnits[a]||{},this.$$executionUnits[a][b])throw"Controller and Action already exist!";this.$$executionUnits[a][b]=c},a.prototype.$storeContext=function(a,b,c,d){var e=this.$createContext(a,b,c,d);return this.$$contexts.push(e),e},a.prototype.$createContext=function(a,b,c,d){return new window.stik.Context(a,b,c,d)},a.prototype.$buildContexts=function(){var a,b,c,d=!1;if(0===Object.keys(this.$$executionUnits).length)throw"no execution units available";for(a in this.$$executionUnits)for(b in this.$$executionUnits[a])c=this.$$executionUnits[a][b],this.$bindExecutionUnit(a,b,c)&&(d=!0);return d},a.prototype.$bindExecutionUnit=function(a,b,c){var d,e,f,g;for(d=this.$findControllerTemplates(a,b),e=this.$mergeObjs(this.$$modules,this.$$boundaries.controller),f=d.length;f--;)g=this.$storeContext(a,b,d[f],c),g.$load(e,this.$$selector);return d.length>0},a.prototype.$applyBehavior=function(a){var b,c,d;for(b=this.$findBehaviorTemplates(a),c=this.$mergeObjs(this.$$modules,this.$$boundaries.behavior),d=b.length;d--;)a.$load(b[d],c,this.$$selector);return b.length>0},a.prototype.$applyBehaviors=function(){var a,b;for(a=!1,b=this.$$behaviors.length;b--;)this.$applyBehavior(this.$$behaviors[b])&&(a=!0);return a},a.prototype.$mergeObjs=function(a,b){var c,d;c={};for(d in a)c[d]=a[d];for(d in b)c[d]=b[d].$$to;return c},a.prototype.$findControllerTemplates=function(a,b,c){var d=document;c&&(d=c);var e="[data-controller="+a+"][data-action="+b+"]:not([class*=stik-bound])";return d.querySelectorAll(e)},a.prototype.$findBehaviorTemplates=function(a,b){var c=document;b&&(c=b);var d="[class*="+a.$$className+"]:not([data-behaviors*="+a.$$name+"])";return c.querySelectorAll(d)},window.stik.Manager=a}(),function(){var a={$currentDOMSelector:function(){return window.hasOwnProperty("MooTools")?window.document.id:window.hasOwnProperty("Zepto")?window.Zepto:window.hasOwnProperty("jQuery")?window.jQuery:void 0}};window.stik.DOMLibLoader=a}(),function(){if(window.stik.$$manager)throw"Stik.js is already loaded. Check your requires ;)";window.stik.$$manager=new window.stik.Manager({$courier:new window.stik.Courier,$urlState:new window.stik.UrlState},window.stik.DOMLibLoader.$currentDOMSelector()),window.stik.controller=function(a,b,c){window.stik.$$manager.$addController(a,b,c)},window.stik.behavior=function(a,b){return this.$$manager.$addBehavior(a,b)},window.stik.bindLazy=function(){if(!this.$$manager.$buildContexts()&!this.$$manager.$applyBehaviors())throw"nothing to bind!"},window.stik.boundary=function(a){this.$$manager.$addBoundary(a.as,a.from,a.to)}}();