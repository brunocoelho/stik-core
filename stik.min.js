// ==========================================================================
// Project:   Stik.js - JavaScript Separation Of Concerns
// Copyright: Copyright 2013-2014 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/stikjs/stik.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.9.0 | From: 02-03-2014

if(window.stik={labs:{}},function(){Function.prototype.method=function(a,b){return this.hasOwnProperty(a)?void 0:(this.prototype[a]=b,this)}}(),function(){function a(){}window.stik.injectable=function(b){function c(a){return b.instantiable===!0?d(e(a)):b.callable===!0?f({},e(a)):b.module}function d(c){var d,e;return a.prototype=b.module.prototype,d=new a,e=f(d,c),Object(e)===e?e:d}function e(a){var c=new window.stik.Injector(b.module,a);return c.$resolveDependencies()}function f(a,c){return b.module.apply(a,c)}return b.instantiable=b.instantiable||!1,b.callable=b.callable||!1,b.resolve=c,b}}(),window.stik.createController=function(a){function b(b,c){var d=window.stik.action({name:b,controller:a.name,executionUnit:c});return a.$$actions[b]=d,d}function c(b){var c,d=!1;for(c in a.$$actions)a.$$actions[c].bind(b)&&(d=!0);return d}if(!a.name)throw"Controller needs a name";return a.$$actions={},a.action=b,a.bind=c,a},window.stik.action=function(a){function b(b){var c,d;for(c=a.findTemplates(),d=c.length;d--;)e(c[d]).context.$load(a.executionUnit,b);return c.length>0}function c(a){var b=new window.stik.Injector(this.$$executionUnit,a);return b.$resolveDependencies()}function d(b){var c=document;b&&(c=b);var d="[data-controller="+a.controller+"][data-action="+a.name+"]:not([class*=stik-bound])";return c.querySelectorAll(d)}function e(b){return{context:new window.stik.Context(a.controller,a.name,b),executionUnit:a.executionUnit}}if(!a.controller)throw"Action needs an controller name";if(!a.name)throw"Action name can't be empty";if(!a.executionUnit)throw"Action needs an execution unit";return a.bind=b,a.$resolveDependencies=c,a.findTemplates=d,a.bindWithTemplate=e,a},function(){function a(a,b,c){this.$$controller=a,this.$$action=b,this.$$template=window.stik.injectable({module:c})}a.method("$load",function(a,b){var c=this.$resolveDependencies(a,this.$mergeModules(b));a.apply(this,c),this.$markAsBound()}),a.method("$resolveDependencies",function(a,b){var c=new window.stik.Injector(a,b);return c.$resolveDependencies()}),a.method("$mergeModules",function(a){return a.$context=this,a.$template=this.$$template,a}),a.method("$markAsBound",function(){var a=this.$$template.resolve();a.className=(a.className+" stik-bound").trim()}),window.stik.Context=a}(),window.stik.createBehavior=function(a){function b(b){for(var d=a.findTemplates(),e=d.length;e--;)c(d[e],b);return d.length>0}function c(b,c){c.$template=window.stik.injectable({module:b});var d=e(c);a.executionUnit.apply({},d),f(b)}function d(b){var c=document;b&&(c=b);var d="[class*="+a.name+"]:not([data-behaviors*="+a.name+"])";return c.querySelectorAll(d)}function e(b){var c=new window.stik.Injector(a.executionUnit,b);return c.$resolveDependencies()}function f(b){var c=b.getAttribute(g);c=((c||"")+" "+a.name).trim(),b.setAttribute(g,c)}if(!a.name)throw"name is missing";if(-1!==a.name.indexOf(" "))throw"invalid name. Please use dash(-) instead of spaces";if(!a.executionUnit)throw"executionUnit is missing";var g="data-behaviors";return a.bind=b,a.findTemplates=d,a}(function(){function a(a,b,c,d){if(-1!==a.indexOf(" "))throw"Invalid 'as'. Can't have spaces";if(!b)throw"Invalid 'to'. Can't be null";this.$$as=a,this.$$to=window.stik.injectable({module:b,instantiable:c,callable:d})}window.stik.Boundary=a})(),function(){function a(a,b){this.$$executionUnit=a,this.$$modules=b}a.method("$resolveDependencies",function(){var a=this.$extractArguments();return this.$grabModules(a)}),a.method("$extractArguments",function(){var a,b,c;return a=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,b=this.$$executionUnit.toString(),c=b.match(a)[1].split(","),this.$trimmedArgs(c)}),a.method("$trimmedArgs",function(a){var b=[];return a.forEach(function(a){b.push(a.trim())}),b}),a.method("$grabModules",function(a){var b,c;if(c=[],1===a.length&&""===a[0])return[];for(var d=0;d<a.length;d++){if(!(b=this.$$modules[a[d]]))throw"Stik could not find this module ("+a[d]+")";c.push(b.resolve(this.$$modules))}return c}),window.stik.Injector=a}(),function(){function a(){this.$$behaviors=[],this.$$controllers={},this.$$boundaries={controller:{},behavior:{}}}a.method("$addControllerWithAction",function(a,b,c){var d,e;return d=this.$storeController(a),e=d.action(b,c),e.bind(this.$extractBoundaries(this.$$boundaries.controller)),d}),a.method("$addController",function(a,b){var c=this.$storeController(a);return b.call({},c),this.$bindController(c),c}),a.method("$storeController",function(a){var b=window.stik.createController({name:a});return this.$$controllers[a]=b,b}),a.method("$addBehavior",function(a,b){var c;if(this.$isBehaviorRegistered(a))throw"behavior already exist with the specified name";return c=this.$createBehavior({name:a,executionUnit:b}),this.$$behaviors.push(c),this.$applyBehavior(c),c}),a.method("$addBoundary",function(a,b,c,d,e){var f,g;return g=this,this.$parseFrom(b,function(b){f=new window.stik.Boundary(a,c,d,e),g.$$boundaries[b][a]=f}),f}),a.method("$parseFrom",function(a,b){var c,d;for(c=a.toLowerCase().split("|"),d=c.length;d--;){if("controller"!==c[d]&&"behavior"!==c[d])throw"Invalid 'from'. Needs to be 'controller' or 'behavior'";b(c[d])}}),a.method("$isBehaviorRegistered",function(a){for(var b=this.$$behaviors.length;b--;)if(this.$$behaviors[b].name===a)return!0;return!1}),a.method("$createBehavior",function(a,b){return window.stik.createBehavior(a,b)}),a.method("$applyBehavior",function(a){var b=this.$extractBoundaries(this.$$boundaries.behavior);return a.bind(b)}),a.method("$applyBehaviors",function(){var a,b;for(a=!1,b=this.$$behaviors.length;b--;)this.$applyBehavior(this.$$behaviors[b])&&(a=!0);return a}),a.method("$extractBoundaries",function(a){var b,c;b={};for(c in a)b[c]=a[c].$$to;return b}),a.method("$bindActionWithTemplate",function(a,b,c){var d,e;return d=this.$extractBoundaries(this.$$boundaries.controller),e=this.$$controllers[a].$$actions[b].bindWithTemplate(c,d),e.modules=d,e}),a.method("$bindActions",function(){var a,b,c;a=this.$extractBoundaries(this.$$boundaries.controller),b=!1;for(c in this.$$controllers)this.$$controllers[c].bind(a)&&(b=!0);return b}),a.method("$bindController",function(a){var b=this.$extractBoundaries(this.$$boundaries.controller);a.bind(b)}),window.stik.Manager=a}(),window.stik.$$manager)throw"Stik is already loaded. Check your requires ;)";window.stik.$$manager=new window.stik.Manager,window.stik.controller=function(a,b,c){return"string"==typeof b?window.stik.$$manager.$addControllerWithAction(a,b,c):window.stik.$$manager.$addController(a,b)},window.stik.behavior=function(a,b){return this.$$manager.$addBehavior(a,b)},window.stik.bindLazy=function(){if(!this.$$manager.$bindActions()&!this.$$manager.$applyBehaviors())throw"nothing to bind!"},window.stik.boundary=function(a){return this.$$manager.$addBoundary(a.as,a.from,a.to,a.inst,a.call)},function(){function a(a,d){if(!a)throw"Stik helper needs a name";if(!d||"function"!=typeof d)throw"Stik helper needs a function";c[a]=window.stik.injectable({module:d,callable:!0}),b[a]=function(){return c[a].resolve(c).apply({},arguments)}}var b={},c={};window.stik.boundary({as:"$h",from:"controller|behavior",to:b}),window.stik.helper=a}(),function(){function a(){this.$$subscriptions={}}function b(a,b){this.$$id="#"+Math.floor(16777215*Math.random()).toString(16),this.$$box=a,this.$$opener=b}a.method("$receive",function(a,c){var d=new b(a,c);return this.$$subscriptions[a]=this.$$subscriptions[a]||[],this.$$subscriptions[a].push(d),this.$unsubscribe.bind(this,d)}),a.method("$unsubscribe",function(a){this.$$subscriptions[a.$$box]=this.$$subscriptions[a.$$box].filter(function(b){return b.$$id!==a.$$id})}),a.method("$send",function(a,b){var c,d;if(c=this.$$subscriptions[a],!c||0===c.length)throw"no one is waiting for this message";for(d=c.length;d--;)c[d].$$opener(b)}),window.stik.Courier=a,window.stik.boundary({as:"$courier",from:"controller|behavior",to:new a})}(),window.stik.viewBag=function(a){function b(a){for(var b,c=f(),d=c.length;d--;)b=c[d].getAttribute(i),void 0!==a[b]&&e(c[d],a[b])}function c(){for(var b,c=f(a),e={},g=c.length;g--;)b=c[g].getAttribute(i),e[b]=d(c[g]);return e}function d(a){return g(a)?a.value:a.textContent}function e(a,b){g(a)?a.value=b:a.textContent=b}function f(){return a.getAttribute(i)?[a]:a.querySelectorAll("["+i+"]")}function g(a){return"INPUT"===a.nodeName.toUpperCase()||"TEXTAREA"===a.nodeName.toUpperCase()}var h={},i="data-bind";if(!a)throw"Stik viewBag needs to a view to be attached to";return h.$push=b,h.$pull=c,h},window.stik.boundary({as:"$viewBag",from:"controller|behavior",call:!0,to:window.stik.viewBag}),function(){function a(a){b(a),this.$$env=a,this.$$template=c(a.template),this.$$context=void 0;var d=window.stik.$$manager.$bindActionWithTemplate(this.$$env.name,this.$$env.action,this.$$template);this.$$context=d.context,this.$$modules=d.modules,this.$$executionUnit=d.executionUnit}function b(a){if(!a)throw"Lab needs an environment to run";if(!a.name)throw"name can't be empty";if(!a.action)throw"action can't be empty";if(!a.template)throw"template can't be empty"}function c(a){var b=document.implementation.createHTMLDocument();return b.body.innerHTML=a,b.body.firstChild}a.method("run",function(){this.$$context.$load(this.$$executionUnit,this.$$modules)}),window.stik.labs.Controller=a}();