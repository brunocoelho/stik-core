// ==========================================================================
// Project:   Stik.js - JavaScript Separation Of Concerns
// Copyright: Copyright 2011-2013 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/stikjs/stik.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.8.0 | From: 25-01-2014

window.stik={labs:{}},function(){function a(){}function b(a,b,c){this.$$module=a,this.$$instantiable=b||!1,this.$$callable=c||!1}function c(b,c){var d,f;return a.prototype=b.prototype,d=new a,f=e(b,d,c),Object(f)===f?f:d}function d(a,b){var c=new window.stik.Injector(a,b);return c.$resolveDependencies()}function e(a,b,c){return a.apply(b,c)}b.prototype.$resolve=function(a){return this.$$instantiable?c(this.$$module,d(this.$$module,a)):this.$$callable?e(this.$$module,{},d(this.$$module,a)):this.$$module},window.stik.Injectable=b}(),function(){function a(a,b,c,d){if(!a)throw"controller is missing";if(!b)throw"action is missing";if(!c)throw"template is missing";if(!d)throw"execution unit is missing";this.$$controller=a,this.$$action=b,this.$$executionUnit=d,this.$$template=new window.stik.Injectable(c,!1),this.$$viewBag=new window.stik.Injectable(new window.stik.ViewBag(c),!1)}a.prototype.$load=function(a){var b=this.$resolveDependencies(this.$mergeModules(a));this.$$executionUnit.apply({},b),this.$markAsBound()},a.prototype.$resolveDependencies=function(a){var b=new window.stik.Injector(this.$$executionUnit,a);return b.$resolveDependencies()},a.prototype.$mergeModules=function(a){return a.$context=this,a.$template=this.$$template,a.$viewBag=this.$$viewBag,a},a.prototype.$markAsBound=function(){var a=this.$$template.$resolve();a.className=(a.className+" stik-bound").trim()},window.stik.Context=a}(),function(){function a(a,b){if(!a)throw"name is missing";if(-1!==a.indexOf(" "))throw"invalid name. Please use dash(-) instead of spaces";if(!b)throw"executionUnit is missing";this.$$className=a,this.$$name=c+"-"+a,this.$$executionUnit=b}var b="data-behaviors",c="bh";a.prototype.$load=function(a,b){b.$template=new window.stik.Injectable(a);var c=this.$resolveDependencies(b);this.$$executionUnit.apply({},c),this.$markAsApplyed(a)},a.prototype.$resolveDependencies=function(a){var b=new window.stik.Injector(this.$$executionUnit,a);return b.$resolveDependencies()},a.prototype.$markAsApplyed=function(a){var c;c=a.getAttribute(b),c=((c||"")+" "+this.$$name).trim(),a.setAttribute(b,c)},window.stik.Behavior=a}(),function(){function a(a,b,c,d){if(-1!==a.indexOf(" "))throw"Invalid 'as'. Can't have spaces";if(!b)throw"Invalid 'to'. Can't be null";this.$$as=a,this.$$to=new window.stik.Injectable(b,c,d)}window.stik.Boundary=a}(),function(){function a(a,b){this.$$executionUnit=a,this.$$modules=b}a.prototype.$resolveDependencies=function(){var a=this.$extractArguments();return this.$grabModules(a)},a.prototype.$extractArguments=function(){var a,b,c;return a=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,b=this.$$executionUnit.toString(),c=b.match(a)[1].split(","),this.$trimmedArgs(c)},a.prototype.$trimmedArgs=function(a){var b=[];return a.forEach(function(a){b.push(a.trim())}),b},a.prototype.$grabModules=function(a){var b,c;if(c=[],1===a.length&&""===a[0])return[];for(var d=0;d<a.length;d++){if(!(b=this.$$modules[a[d]]))throw"Â¿"+a[d]+"? These are not the droids you are looking for! (e.g. this module does not exists)";c.push(b.$resolve(this.$$modules))}return c},window.stik.Injector=a}(),function(){function a(){this.$$contexts=[],this.$$behaviors=[],this.$$executionUnits={},this.$$boundaries={controller:{},behavior:{}}}a.prototype.$addController=function(a,b,c){if(!a)throw"controller can't be empty";if(!b)throw"action can't be empty";if(!c)throw"execution unit is missing";this.$storeExecutionUnit(a,b,c),this.$bindExecutionUnit(a,b,c)},a.prototype.$addBehavior=function(a,b){var c;if(this.$isBehaviorRegistered(a))throw"behavior already exist with the specified name";return c=this.$createBehavior(a,b),this.$$behaviors.push(c),this.$applyBehavior(c),c},a.prototype.$addBoundary=function(a,b,c,d,e){var f,g;return g=this,this.$parseFrom(b,function(b){f=new window.stik.Boundary(a,c,d,e),g.$$boundaries[b][a]=f}),f},a.prototype.$parseFrom=function(a,b){var c,d;for(c=a.toLowerCase().split("|"),d=c.length;d--;){if("controller"!==c[d]&&"behavior"!==c[d])throw"Invalid 'from'. Needs to be 'controller' or 'behavior'";b(c[d])}},a.prototype.$isBehaviorRegistered=function(a){for(var b=this.$$behaviors.length;b--;)if(this.$$behaviors[b].$$name===a)return!0;return!1},a.prototype.$createBehavior=function(a,b){return new window.stik.Behavior(a,b)},a.prototype.$storeExecutionUnit=function(a,b,c){if(this.$$executionUnits[a]=this.$$executionUnits[a]||{},this.$$executionUnits[a][b])throw"Controller and Action already exist!";this.$$executionUnits[a][b]=c},a.prototype.$buildContexts=function(){var a,b,c,d;if(d=!1,0===Object.keys(this.$$executionUnits).length)throw"no execution units available";for(a in this.$$executionUnits)for(b in this.$$executionUnits[a])c=this.$$executionUnits[a][b],this.$bindExecutionUnit(a,b,c)&&(d=!0);return d},a.prototype.$bindExecutionUnit=function(a,b,c){var d,e,f,g;for(d=this.$findControllerTemplates(a,b),e=this.$extractBoundaries(this.$$boundaries.controller),f=d.length;f--;)g=this.$storeContext(a,b,d[f],c),g.$load(e);return d.length>0},a.prototype.$storeContext=function(a,b,c,d){var e=this.$createContext(a,b,c,d);return this.$$contexts.push(e),e},a.prototype.$createContext=function(a,b,c,d){return new window.stik.Context(a,b,c,d)},a.prototype.$applyBehavior=function(a){var b,c,d;for(b=this.$findBehaviorTemplates(a),c=this.$extractBoundaries(this.$$boundaries.behavior),d=b.length;d--;)a.$load(b[d],c);return b.length>0},a.prototype.$applyBehaviors=function(){var a,b;for(a=!1,b=this.$$behaviors.length;b--;)this.$applyBehavior(this.$$behaviors[b])&&(a=!0);return a},a.prototype.$extractBoundaries=function(a){var b,c;b={};for(c in a)b[c]=a[c].$$to;return b},a.prototype.$findControllerTemplates=function(a,b,c){var d=document;c&&(d=c);var e="[data-controller="+a+"][data-action="+b+"]:not([class*=stik-bound])";return d.querySelectorAll(e)},a.prototype.$findBehaviorTemplates=function(a,b){var c=document;b&&(c=b);var d="[class*="+a.$$className+"]:not([data-behaviors*="+a.$$name+"])";return c.querySelectorAll(d)},a.prototype.$bindExecutionUnitWithTemplate=function(a,b,c){var d,e;return d=this.$extractBoundaries(this.$$boundaries.controller),e=this.$createContext(a,b,c,this.$$executionUnits[a][b]),[e,d]},window.stik.Manager=a}(),function(){if(window.stik.$$manager)throw"Stik.js is already loaded. Check your requires ;)";window.stik.$$manager=new window.stik.Manager,window.stik.controller=function(a,b,c){window.stik.$$manager.$addController(a,b,c)},window.stik.behavior=function(a,b){return this.$$manager.$addBehavior(a,b)},window.stik.bindLazy=function(){if(!this.$$manager.$buildContexts()&!this.$$manager.$applyBehaviors())throw"nothing to bind!"},window.stik.boundary=function(a){this.$$manager.$addBoundary(a.as,a.from,a.to,a.inst,a.call)}}(),function(){function a(){this.$$subscriptions={}}function b(a,b){this.$$id="#"+Math.floor(16777215*Math.random()).toString(16),this.$$box=a,this.$$opener=b}a.prototype.$receive=function(a,c){var d=new b(a,c);return this.$$subscriptions[a]=this.$$subscriptions[a]||[],this.$$subscriptions[a].push(d),this.$unsubscribe.bind(this,d)},a.prototype.$unsubscribe=function(a){this.$$subscriptions[a.$$box]=this.$$subscriptions[a.$$box].filter(function(b){return b.$$id!==a.$$id})},a.prototype.$send=function(a,b){var c,d;if(c=this.$$subscriptions[a],!c||0===c.length)throw"no one is waiting for this message";for(d=c.length;d--;)c[d].$$opener(b)},window.stik.Courier=a,window.stik.boundary({as:"$courier",from:"controller|behavior",to:new a})}(),function(){function a(a){this.$$template=a}function b(a){return e(a)?a.value:a.textContent}function c(a,b){e(a)?a.value=b:a.textContent=b}function d(a){return a.getAttribute(f)?[a]:a.querySelectorAll("["+f+"]")}function e(a){return"INPUT"===a.nodeName.toUpperCase()||"TEXTAREA"===a.nodeName.toUpperCase()}var f="data-bind";a.prototype.$push=function(a){var b,e,g;for(b=d(this.$$template),g=b.length;g--;)e=b[g].getAttribute(f),void 0!==a[e]&&c(b[g],a[e])},a.prototype.$pull=function(){var a,c,e,g;for(c={},a=d(this.$$template),g=a.length;g--;)e=a[g].getAttribute(f),c[e]=b(a[g]);return c},window.stik.ViewBag=a,window.stik.boundary({as:"$viewBag",from:"controller|behavior",inst:!0,to:a})}(),function(){function a(a){b(a),this.$$env=a,this.$$template=c(a.template),this.$$context=void 0}function b(a){if(!a)throw"Lab needs an environment to run";if(!a.name)throw"name can't be empty";if(!a.action)throw"action can't be empty";if(!a.template)throw"template can't be empty"}function c(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild}a.prototype.run=function(){var a=window.stik.$$manager.$bindExecutionUnitWithTemplate(this.$$env.name,this.$$env.action,this.$$template);this.$$context=a[0],this.$$context.$load(a[1])},window.stik.labs.Controller=a}();