// ==========================================================================
// Project:   Stik.js - JavaScript Separation Of Concerns
// Copyright: Copyright 2013-2014 Lukas Alexandre
// License:   Licensed under MIT license
//            See https://github.com/stikjs/stik.js/blob/master/LICENSE
// ==========================================================================

// Version: 0.10.0 | From: 04-03-2014

if(window.stik)throw"Stik is already loaded. Check your requires ;)";window.stik={labs:{}},function(){Function.prototype.method=function(a,b){return this.hasOwnProperty(a)?void 0:(this.prototype[a]=b,this)}}(),function(){function a(){}window.stik.injectable=function(b){function c(a){return b.instantiable===!0?d(e(a)):b.resolvable===!0?f({},e(a)):b.module}function d(c){var d,e;return a.prototype=b.module.prototype,d=new a,e=f(d,c),Object(e)===e?e:d}function e(a){var c=window.stik.injector({executionUnit:b.module,modules:a});return c.resolveDependencies()}function f(a,c){return b.module.apply(a,c)}return b.instantiable=b.instantiable||!1,b.resolvable=b.resolvable||!1,b.resolve=c,b}}(),window.stik.createController=function(a){function b(b,c){var d=window.stik.action({name:b,controller:a.name,executionUnit:c});return a.actions[b]=d,d}function c(b){var c,d=!1;for(c in a.actions)a.actions[c].bind(b)&&(d=!0);return d}if(!a.name)throw"Stik: Controller needs a name";return a.actions={},a.action=b,a.bind=c,a},window.stik.action=function(a){function b(b){var c,d;for(c=a.findTemplates(),d=c.length;d--;)e(c[d]).context.load(a.executionUnit,b);return c.length>0}function c(a){var b=window.stik.injector(this.$$executionUnit,a);return b.$resolveDependencies()}function d(b){var c=document;b&&(c=b);var d="[data-controller="+a.controller+"][data-action="+a.name+"]:not([class*=stik-bound])";return c.querySelectorAll(d)}function e(b){return{context:window.stik.context({controller:a.controller,action:a.name,template:b}),executionUnit:a.executionUnit}}if(!a.controller)throw"Stik: Action needs an controller name";if(!a.name)throw"Stik: Action name can't be empty";if(!a.executionUnit)throw"Stik: Action needs a function to use as its execution unit";return a.bind=b,a.$resolveDependencies=c,a.findTemplates=d,a.bindWithTemplate=e,a},window.stik.context=function(a){function b(b,f){var g=c(b,d(f));b.apply(a,g),e()}function c(a,b){var c=window.stik.injector({executionUnit:a,modules:b});return c.resolveDependencies()}function d(b){return b.$template=a.template,b}function e(){var b=a.template.resolve();b.className=(b.className+" stik-bound").trim()}return a.template=window.stik.injectable({module:a.template}),a.load=b,a},window.stik.createBehavior=function(a){function b(b){for(var d=a.findTemplates(),e=d.length;e--;)c(d[e],b);return d.length>0}function c(b,c){c.$template=window.stik.injectable({module:b});var d=e(c);a.executionUnit.apply({},d),f(b)}function d(){var b="[class*="+a.name+"]:not([data-behaviors*="+a.name+"])";return document.querySelectorAll(b)}function e(b){var c=window.stik.injector({executionUnit:a.executionUnit,modules:b});return c.resolveDependencies()}function f(b){var c=b.getAttribute(g);c=((c||"")+" "+a.name).trim(),b.setAttribute(g,c)}if(!a.name)throw"Stik: Behavior name is missing";if(-1!==a.name.indexOf(" "))throw"Stik: '"+a.name+"' is not a valid Behavior name. Please replace empty spaces with dashes ('-')";if(!a.executionUnit)throw"Stik: Behavior needs a function to use as its execution unit";var g="data-behaviors";return a.bind=b,a.findTemplates=d,a},window.stik.createBoundary=function(a){if(-1!==a.as.indexOf(" "))throw"Stik: '"+a.as+"' is not a valid Boundary name. Please replace empty spaces with dashes ('-')";if(!a.to)throw"Stik: Boundary needs an object or function as 'to'";var b={};return b.to=window.stik.injectable({module:a.to,instantiable:a.instantiable,resolvable:a.resolvable}),b},window.stik.injector=function(a){function b(){var a=c();return e(a)}function c(){var b,c,e;return b=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,c=a.executionUnit.toString(),e=c.match(b)[1].split(","),d(e)}function d(a){var b=[];return a.forEach(function(a){b.push(a.trim())}),b}function e(b){var c,d;if(d=[],1===b.length&&""===b[0])return[];for(var e=0;e<b.length;e++){if(!(c=a.modules[b[e]]))throw"Stik could not find this module ("+b[e]+")";d.push(c.resolve(a.modules))}return d}if(!a.executionUnit)throw"Stik: Injector needs a function to use as its execution unit";return a.resolveDependencies=b,a},function(){function a(){this.$$behaviors=[],this.$$controllers={},this.$$boundaries={controller:{},behavior:{}}}a.method("$addControllerWithAction",function(a,b,c){var d,e;return d=this.$storeController(a),e=d.action(b,c),e.bind(this.$extractBoundaries(this.$$boundaries.controller)),d}),a.method("$addController",function(a,b){var c=this.$storeController(a);return b.call({},c),this.$bindController(c),c}),a.method("$storeController",function(a){var b=window.stik.createController({name:a});return this.$$controllers[a]=b,b}),a.method("$addBehavior",function(a,b){var c;if(this.$isBehaviorRegistered(a))throw"Stik: Another behavior already exist with name '"+a+"'";return c=this.$createBehavior({name:a,executionUnit:b}),this.$$behaviors.push(c),this.$applyBehavior(c),c}),a.method("$addBoundary",function(a){var b,c;return c=this,this.$parseFrom(a.from,function(d){b=window.stik.createBoundary(a),c.$$boundaries[d][a.as]=b}),b}),a.method("$parseFrom",function(a,b){var c,d;for(c=a.toLowerCase().split("|"),d=c.length;d--;){if("controller"!==c[d]&&"behavior"!==c[d])throw"Stik: Invalid boundary 'from' specified. Please use 'controller' or 'behavior' or leave it blank to default to both";b(c[d])}}),a.method("$isBehaviorRegistered",function(a){for(var b=this.$$behaviors.length;b--;)if(this.$$behaviors[b].name===a)return!0;return!1}),a.method("$createBehavior",function(a,b){return window.stik.createBehavior(a,b)}),a.method("$applyBehavior",function(a){var b=this.$extractBoundaries(this.$$boundaries.behavior);return a.bind(b)}),a.method("$applyBehaviors",function(){var a,b;for(a=!1,b=this.$$behaviors.length;b--;)this.$applyBehavior(this.$$behaviors[b])&&(a=!0);return a}),a.method("$extractBoundaries",function(a){var b,c;b={};for(c in a)b[c]=a[c].to;return b}),a.method("$bindActionWithTemplate",function(a,b,c){var d,e;return d=this.$extractBoundaries(this.$$boundaries.controller),e=this.$$controllers[a].actions[b].bindWithTemplate(c,d),e.modules=d,e}),a.method("$bindActions",function(){var a,b,c;a=this.$extractBoundaries(this.$$boundaries.controller),b=!1;for(c in this.$$controllers)this.$$controllers[c].bind(a)&&(b=!0);return b}),a.method("$bindController",function(a){var b=this.$extractBoundaries(this.$$boundaries.controller);a.bind(b)}),window.stik.Manager=a}(),window.stik.$$manager=new window.stik.Manager,window.stik.controller=function(a,b,c){return"string"==typeof b?window.stik.$$manager.$addControllerWithAction(a,b,c):window.stik.$$manager.$addController(a,b)},window.stik.behavior=function(a,b){return this.$$manager.$addBehavior(a,b)},window.stik.bindLazy=function(){if(!this.$$manager.$bindActions()&!this.$$manager.$applyBehaviors())throw"Stik: Nothing new to bind!"},window.stik.boundary=function(a){return this.$$manager.$addBoundary(a)},function(){var a={},b={};window.stik.helper=function(c,d){if(!c)throw"Stik: Helper needs a name";if(!d||"function"!=typeof d)throw"Stik: Helper needs a function";return b[c]=window.stik.injectable({module:d,resolvable:!0}),a[c]=function(){return b[c].resolve(b).apply({},arguments)},a[c]},window.stik.boundary({as:"$h",from:"controller|behavior",to:a})}(),function(){function a(){this.$$subscriptions={}}function b(a,b){this.$$id="#"+Math.floor(16777215*Math.random()).toString(16),this.$$box=a,this.$$opener=b}a.method("$receive",function(a,c){var d=new b(a,c);return this.$$subscriptions[a]=this.$$subscriptions[a]||[],this.$$subscriptions[a].push(d),this.$unsubscribe.bind(this,d)}),a.method("$unsubscribe",function(a){this.$$subscriptions[a.$$box]=this.$$subscriptions[a.$$box].filter(function(b){return b.$$id!==a.$$id})}),a.method("$send",function(a,b){var c,d;if(c=this.$$subscriptions[a],!c||0===c.length)throw"Stik: No receiver registered for "+a;for(d=c.length;d--;)c[d].$$opener(b)}),window.stik.Courier=a,window.stik.boundary({as:"$courier",from:"controller|behavior",to:new a})}(),window.stik.viewBag=function(a){function b(a){for(var b,c=f(),d=c.length;d--;)b=c[d].getAttribute(i),void 0!==a[b]&&e(c[d],a[b])}function c(){for(var b,c=f(a),e={},g=c.length;g--;)b=c[g].getAttribute(i),e[b]=d(c[g]);return e}function d(a){return g(a)?a.value:a.textContent}function e(a,b){g(a)?a.value=b:a.textContent=b}function f(){return a.getAttribute(i)?[a]:a.querySelectorAll("["+i+"]")}function g(a){return"INPUT"===a.nodeName.toUpperCase()||"TEXTAREA"===a.nodeName.toUpperCase()}if(!a)throw"Stik: ViewBag needs a template to be attached to";var h={},i="data-bind";return h.$push=b,h.$pull=c,h},window.stik.boundary({as:"$viewBag",from:"controller|behavior",resolvable:!0,to:window.stik.viewBag}),window.stik.labs.controller=function(a){function b(){var b=document.implementation.createHTMLDocument();return b.body.innerHTML=a.template,b.body.firstChild}function c(a){e.context.load(e.executionUnit,d(a))}function d(a){for(dbl in a)e.modules[dbl]=window.stik.injectable({module:a[dbl]});return e.modules}if(!a)throw"Stik: Controller Lab needs an environment to run";if(!a.name)throw"Stik: Controller Lab needs a name";if(!a.action)throw"Stik: Controller Lab needs the action name";if(!a.template)throw"Stik: Controller Lab needs a template";var e,f={};return f.template=b(),e=window.stik.$$manager.$bindActionWithTemplate(a.name,a.action,f.template),f.run=c,f};